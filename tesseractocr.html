<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìÑ Tesseract OCR - Yerel PDF Sayfa OCR</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            padding: 20px;
            color: #fff;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 10px;
            font-size: 2rem;
        }

        .subtitle {
            text-align: center;
            color: #888;
            margin-bottom: 30px;
            font-size: 0.95rem;
        }

        .settings {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            align-items: center;
        }

        .setting-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .setting-group label {
            font-size: 0.85rem;
            color: #aaa;
        }

        .setting-group select {
            padding: 10px 15px;
            border-radius: 8px;
            border: 1px solid #444;
            background: #2a2a4a;
            color: #fff;
            font-size: 1rem;
            cursor: pointer;
        }

        .drop-zone {
            border: 3px dashed #4a4a6a;
            border-radius: 16px;
            padding: 60px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(255,255,255,0.02);
            margin-bottom: 20px;
        }

        .drop-zone:hover, .drop-zone.dragover {
            border-color: #7c3aed;
            background: rgba(124, 58, 237, 0.1);
        }

        .drop-zone-icon {
            font-size: 4rem;
            margin-bottom: 15px;
        }

        .drop-zone-text {
            font-size: 1.1rem;
            color: #aaa;
        }

        .drop-zone-hint {
            font-size: 0.85rem;
            color: #666;
            margin-top: 10px;
        }

        .file-input {
            display: none;
        }

        .files-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
            max-height: 500px;
            overflow-y: auto;
            padding: 10px;
        }

        .file-card {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            position: relative;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .file-card:hover {
            background: rgba(255,255,255,0.08);
        }

        .file-card.processing {
            border-color: #f59e0b;
            animation: pulse 1.5s infinite;
        }

        .file-card.success {
            border-color: #10b981;
        }

        .file-card.error {
            border-color: #ef4444;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .file-number {
            position: absolute;
            top: -10px;
            left: -10px;
            background: #7c3aed;
            color: #fff;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .file-preview {
            width: 100%;
            height: 100px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 10px;
            background: #2a2a4a;
        }

        .file-name {
            font-size: 0.75rem;
            color: #aaa;
            word-break: break-all;
            line-height: 1.3;
            max-height: 50px;
            overflow: hidden;
        }

        .file-status {
            margin-top: 8px;
            font-size: 1.2rem;
        }

        .file-remove {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(239, 68, 68, 0.8);
            border: none;
            color: #fff;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 0.8rem;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .file-card:hover .file-remove {
            opacity: 1;
        }

        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .file-download {
            position: absolute;
            bottom: 5px;
            right: 5px;
            background: rgba(16, 185, 129, 0.9);
            border: none;
            color: #fff;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 0.9rem;
            opacity: 0;
            transition: opacity 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .file-card:hover .file-download {
            opacity: 1;
        }

        .file-card.success .file-download {
            opacity: 0.7;
        }

        .file-card.success:hover .file-download {
            opacity: 1;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #7c3aed, #5b21b6);
            color: #fff;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(124, 58, 237, 0.3);
        }

        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: #fff;
        }

        .btn-secondary:hover:not(:disabled) {
            background: rgba(255,255,255,0.2);
        }

        .btn-success {
            background: linear-gradient(135deg, #10b981, #059669);
            color: #fff;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .progress-section {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            display: none;
        }

        .progress-section.active {
            display: block;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .progress-bar-container {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            height: 20px;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #7c3aed, #10b981);
            border-radius: 10px;
            transition: width 0.3s ease;
            width: 0%;
        }

        .progress-details {
            display: flex;
            gap: 20px;
            font-size: 0.9rem;
            color: #aaa;
        }

        .log-section {
            background: #0d0d1a;
            border-radius: 12px;
            padding: 15px;
            max-height: 200px;
            overflow-y: auto;
            font-family: 'Consolas', monospace;
            font-size: 0.85rem;
        }

        .log-entry {
            padding: 5px 0;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        .log-entry.error {
            color: #ef4444;
        }

        .log-entry.success {
            color: #10b981;
        }

        .log-entry.info {
            color: #3b82f6;
        }

        .log-time {
            color: #666;
            margin-right: 10px;
        }

        .stats {
            display: flex;
            gap: 30px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        .stat {
            text-align: center;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #7c3aed;
        }

        .stat-label {
            font-size: 0.8rem;
            color: #666;
        }

        .warning-box {
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid #f59e0b;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            font-size: 0.9rem;
        }

        .warning-box strong {
            color: #f59e0b;
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            flex-direction: column;
            gap: 20px;
        }

        .loading-overlay.hidden {
            display: none;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255,255,255,0.1);
            border-top-color: #7c3aed;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .files-grid {
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            }
            
            .controls {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
        <div id="loadingText">Tesseract.js y√ºkleniyor...</div>
    </div>

    <div class="container">
        <h1>üìÑ Tesseract OCR</h1>
        <p class="subtitle">Yerel OCR - API gerektirmez, tamamen tarayƒ±cƒ±da √ßalƒ±≈üƒ±r</p>

        <div class="warning-box">
            <strong>‚ö†Ô∏è ƒ∞lk Kullanƒ±m:</strong> Dil paketi (~15MB) ilk OCR i≈üleminde indirilecek. 
            Sonraki kullanƒ±mlarda √∂nbellekten y√ºklenir. Her sayfa 5-15 saniye s√ºrebilir.<br>
            <strong>üì¶ √áƒ±ktƒ±:</strong> ƒ∞≈ülem bitince otomatik olarak ZIP indirilir (tekli dosyalar + birle≈üik + JSON).
        </div>

        <div class="settings">
            <div class="setting-group">
                <label>üåê OCR Dili</label>
                <select id="langSelect">
                    <option value="tur" selected>T√ºrk√ße</option>
                    <option value="eng">English</option>
                    <option value="tur+eng">T√ºrk√ße + English</option>
                    <option value="deu">Deutsch</option>
                    <option value="fra">Fran√ßais</option>
                    <option value="ara">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
                </select>
            </div>
        </div>

        <div class="drop-zone" id="dropZone">
            <div class="drop-zone-icon">üñºÔ∏è</div>
            <div class="drop-zone-text">PDF sayfalarƒ±nƒ±n resimlerini buraya s√ºr√ºkleyin</div>
            <div class="drop-zone-text">veya tƒ±klayarak se√ßin</div>
            <div class="drop-zone-hint">üí° Shift ile √ßoklu se√ßimde sƒ±ralƒ± numaralandƒ±rma yapƒ±lƒ±r</div>
        </div>
        <input type="file" id="fileInput" class="file-input" multiple accept="image/*">

        <div class="files-grid" id="filesGrid"></div>

        <div class="controls">
            <button class="btn btn-primary" id="startBtn" disabled>
                üöÄ OCR Ba≈ülat
            </button>
            <button class="btn btn-secondary" id="clearBtn" disabled>
                üóëÔ∏è Temizle
            </button>
            <button class="btn btn-success" id="downloadBtn" disabled>
                üì¶ ZIP ƒ∞ndir (T√ºm√º)
            </button>
        </div>

        <div class="progress-section" id="progressSection">
            <div class="progress-header">
                <span id="progressText">Hazƒ±rlanƒ±yor...</span>
                <span id="progressPercent">0%</span>
            </div>
            <div class="progress-bar-container">
                <div class="progress-bar" id="progressBar"></div>
            </div>
            <div class="progress-details">
                <span>‚è±Ô∏è Ge√ßen: <span id="elapsedTime">00:00</span></span>
                <span>üìÑ ƒ∞≈ülenen: <span id="processedCount">0</span> / <span id="totalCount">0</span></span>
            </div>
            <div class="stats">
                <div class="stat">
                    <div class="stat-value" id="successCount">0</div>
                    <div class="stat-label">‚úÖ Ba≈üarƒ±lƒ±</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="errorCount">0</div>
                    <div class="stat-label">‚ùå Hatalƒ±</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="avgTime">0s</div>
                    <div class="stat-label">‚ö° Ort. S√ºre</div>
                </div>
            </div>
        </div>

        <div class="log-section" id="logSection"></div>
    </div>

    <script>
        // CDN listesi - sƒ±rayla denenecek
        const cdnList = [
            'https://cdnjs.cloudflare.com/ajax/libs/tesseract.js/5.1.1/tesseract.min.js',
            'https://cdn.jsdelivr.net/npm/tesseract.js@5.1.1/dist/tesseract.min.js',
            'https://unpkg.com/tesseract.js@5.1.1/dist/tesseract.min.js',
            'https://cdnjs.cloudflare.com/ajax/libs/tesseract.js/4.1.4/tesseract.min.js',
            'https://cdn.jsdelivr.net/npm/tesseract.js@4.1.4/dist/tesseract.min.js'
        ];

        function loadScript(url) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = url;
                script.onload = () => {
                    // Kƒ±sa bir gecikme ile Tesseract'ƒ±n y√ºklenmesini bekle
                    setTimeout(() => {
                        if (typeof Tesseract !== 'undefined') {
                            resolve();
                        } else {
                            reject(new Error('Tesseract not defined after load'));
                        }
                    }, 100);
                };
                script.onerror = reject;
                document.head.appendChild(script);
            });
        }

        async function loadTesseract() {
            const overlay = document.getElementById('loadingOverlay');
            const loadingText = document.getElementById('loadingText');
            
            for (let i = 0; i < cdnList.length; i++) {
                try {
                    loadingText.textContent = `CDN deneniyor (${i + 1}/${cdnList.length})...`;
                    console.log(`CDN deneniyor: ${cdnList[i]}`);
                    
                    await loadScript(cdnList[i]);
                    
                    if (typeof Tesseract !== 'undefined') {
                        console.log('‚úÖ Tesseract ba≈üarƒ±yla y√ºklendi:', cdnList[i]);
                        overlay.classList.add('hidden');
                        initApp();
                        return;
                    }
                } catch (e) {
                    console.log(`‚ùå CDN ba≈üarƒ±sƒ±z: ${cdnList[i]}`, e.message);
                }
            }
            
            // Hi√ßbiri √ßalƒ±≈ümazsa
            overlay.innerHTML = `
                <div style="color: #ef4444; text-align: center; padding: 20px;">
                    <div style="font-size: 3rem; margin-bottom: 20px;">‚ùå</div>
                    <div style="font-size: 1.2rem; margin-bottom: 10px;">Tesseract.js y√ºklenemedi!</div>
                    <div style="color: #888; margin-bottom: 20px;">T√ºm CDN'ler denendi ama ba≈üarƒ±sƒ±z oldu.</div>
                    <div style="color: #aaa; font-size: 0.9rem;">
                        Olasƒ± √ß√∂z√ºmler:<br>
                        1. ƒ∞nternet baƒülantƒ±nƒ±zƒ± kontrol edin<br>
                        2. VPN kullanƒ±yorsanƒ±z kapatƒ±n<br>
                        3. Tarayƒ±cƒ± √∂nbelleƒüini temizleyin<br>
                        4. Farklƒ± bir tarayƒ±cƒ± deneyin
                    </div>
                    <button onclick="location.reload()" style="margin-top: 20px; padding: 10px 30px; background: #7c3aed; color: #fff; border: none; border-radius: 8px; cursor: pointer; font-size: 1rem;">
                        üîÑ Sayfayƒ± Yenile
                    </button>
                </div>
            `;
        }

        // Sayfa y√ºklendiƒüinde Tesseract'ƒ± y√ºkle
        document.addEventListener('DOMContentLoaded', loadTesseract);

        function initApp() {
            // State
            let files = [];
            let results = [];
            let isProcessing = false;
            let startTime = null;

            // DOM Elements
            const dropZone = document.getElementById('dropZone');
            const fileInput = document.getElementById('fileInput');
            const filesGrid = document.getElementById('filesGrid');
            const startBtn = document.getElementById('startBtn');
            const clearBtn = document.getElementById('clearBtn');
            const downloadBtn = document.getElementById('downloadBtn');
            const progressSection = document.getElementById('progressSection');
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            const progressPercent = document.getElementById('progressPercent');
            const logSection = document.getElementById('logSection');
            const langSelect = document.getElementById('langSelect');

            // Event Listeners
            dropZone.addEventListener('click', () => fileInput.click());
            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropZone.classList.add('dragover');
            });
            dropZone.addEventListener('dragleave', () => {
                dropZone.classList.remove('dragover');
            });
            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.classList.remove('dragover');
                handleFiles(e.dataTransfer.files);
            });
            fileInput.addEventListener('change', (e) => {
                handleFiles(e.target.files);
            });
            startBtn.addEventListener('click', startOCR);
            clearBtn.addEventListener('click', clearAll);
            downloadBtn.addEventListener('click', downloadAsZip);

            // Handle file selection
            function handleFiles(fileList) {
                const newFiles = Array.from(fileList)
                    .filter(f => f.type.startsWith('image/'))
                    .sort((a, b) => a.name.localeCompare(b.name, undefined, { numeric: true }));

                if (newFiles.length === 0) {
                    log('‚ö†Ô∏è Ge√ßerli resim dosyasƒ± bulunamadƒ±', 'error');
                    return;
                }

                files = [...files, ...newFiles];
                log(`üìÅ ${newFiles.length} dosya eklendi (Toplam: ${files.length})`, 'info');
                renderFiles();
                updateButtons();
            }

            // Render file cards
            function renderFiles() {
                filesGrid.innerHTML = files.map((file, index) => {
                    const status = file.status || 'waiting';
                    const statusEmoji = {
                        'waiting': '‚è≥ Bekliyor',
                        'processing': 'üîÑ ƒ∞≈üleniyor',
                        'success': '‚úÖ Tamamlandƒ±',
                        'error': '‚ùå Hata'
                    }[status];

                    const downloadButton = status === 'success' 
                        ? `<button class="file-download" onclick="window.downloadSingle(${index})" title="Bu sayfayƒ± indir">üíæ</button>`
                        : '';

                    return `
                        <div class="file-card ${status}" id="card-${index}">
                            <div class="file-number">${index + 1}</div>
                            <button class="file-remove" onclick="window.removeFile(${index})">‚úï</button>
                            ${downloadButton}
                            <img class="file-preview" src="${URL.createObjectURL(file)}" alt="${file.name}">
                            <div class="file-name">${file.name}</div>
                            <div class="file-status">${statusEmoji}</div>
                        </div>
                    `;
                }).join('');
            }

            // Remove single file - global scope i√ßin
            window.removeFile = function(index) {
                if (isProcessing) return;
                files.splice(index, 1);
                results.splice(index, 1);
                renderFiles();
                updateButtons();
                log(`üóëÔ∏è Dosya kaldƒ±rƒ±ldƒ±`, 'info');
            };

            // Update button states
            function updateButtons() {
                startBtn.disabled = files.length === 0 || isProcessing;
                clearBtn.disabled = files.length === 0 || isProcessing;
                const hasResults = results.filter(r => r && r.text).length > 0;
                downloadBtn.disabled = !hasResults;
            }

            // Clear all
            function clearAll() {
                if (isProcessing) return;
                files = [];
                results = [];
                filesGrid.innerHTML = '';
                progressSection.classList.remove('active');
                updateButtons();
                log('üßπ T√ºm dosyalar temizlendi', 'info');
            }

            // Log function
            function log(message, type = '') {
                const time = new Date().toLocaleTimeString('tr-TR');
                const entry = document.createElement('div');
                entry.className = `log-entry ${type}`;
                entry.innerHTML = `<span class="log-time">[${time}]</span>${message}`;
                logSection.appendChild(entry);
                logSection.scrollTop = logSection.scrollHeight;
            }

            // Update progress
            function updateProgress(current, total, text) {
                const percent = Math.round((current / total) * 100);
                progressBar.style.width = `${percent}%`;
                progressPercent.textContent = `${percent}%`;
                progressText.textContent = text;
                document.getElementById('processedCount').textContent = current;
                document.getElementById('totalCount').textContent = total;

                if (startTime) {
                    const elapsed = Math.floor((Date.now() - startTime) / 1000);
                    const mins = Math.floor(elapsed / 60).toString().padStart(2, '0');
                    const secs = (elapsed % 60).toString().padStart(2, '0');
                    document.getElementById('elapsedTime').textContent = `${mins}:${secs}`;
                }
            }

            // Update stats
            function updateStats(successCount, errorCount, avgTime) {
                document.getElementById('successCount').textContent = successCount;
                document.getElementById('errorCount').textContent = errorCount;
                document.getElementById('avgTime').textContent = `${avgTime.toFixed(1)}s`;
            }

            // Start OCR
            async function startOCR() {
                if (files.length === 0 || isProcessing) return;

                isProcessing = true;
                startTime = Date.now();
                results = new Array(files.length).fill(null);
                
                progressSection.classList.add('active');
                updateButtons();
                
                const lang = langSelect.value;
                log(`üöÄ OCR ba≈ülatƒ±lƒ±yor (Dil: ${lang})`, 'info');
                log(`üìÑ Toplam ${files.length} dosya i≈ülenecek`, 'info');

                let successCount = 0;
                let errorCount = 0;
                let totalTime = 0;
                let worker = null;

                // Initialize Tesseract worker
                try {
                    log('‚è≥ Tesseract worker ba≈ülatƒ±lƒ±yor (dil paketi indiriliyor)...', 'info');
                    
                    worker = await Tesseract.createWorker(lang, 1, {
                        logger: m => {
                            if (m.status === 'loading tesseract core') {
                                progressText.textContent = 'Tesseract core y√ºkleniyor...';
                            } else if (m.status === 'loading language traineddata') {
                                progressText.textContent = `Dil paketi indiriliyor: ${Math.round(m.progress * 100)}%`;
                            } else if (m.status === 'recognizing text') {
                                const pageProgress = Math.round(m.progress * 100);
                                progressText.textContent = `Sayfa analiz ediliyor: ${pageProgress}%`;
                            }
                        }
                    });
                    
                    log('‚úÖ Tesseract hazƒ±r', 'success');
                } catch (err) {
                    log(`‚ùå Tesseract ba≈ülatƒ±lamadƒ±: ${err.message}`, 'error');
                    isProcessing = false;
                    updateButtons();
                    return;
                }

                // Process each file
                for (let i = 0; i < files.length; i++) {
                    const file = files[i];
                    const pageStart = Date.now();

                    files[i].status = 'processing';
                    renderFiles();
                    updateProgress(i, files.length, `Sayfa ${i + 1} i≈üleniyor: ${file.name}`);
                    log(`üìÑ Sayfa ${i + 1} i≈üleniyor: ${file.name}`, 'info');

                    try {
                        const { data } = await worker.recognize(file);
                        
                        results[i] = {
                            page: i + 1,
                            filename: file.name,
                            text: data.text,
                            confidence: data.confidence
                        };

                        files[i].status = 'success';
                        successCount++;
                        
                        const pageTime = (Date.now() - pageStart) / 1000;
                        totalTime += pageTime;
                        
                        log(`‚úÖ Sayfa ${i + 1} tamamlandƒ± (${pageTime.toFixed(1)}s, g√ºven: ${data.confidence.toFixed(1)}%)`, 'success');
                    } catch (err) {
                        files[i].status = 'error';
                        errorCount++;
                        results[i] = {
                            page: i + 1,
                            filename: file.name,
                            text: '',
                            error: err.message
                        };
                        log(`‚ùå Sayfa ${i + 1} hata: ${err.message}`, 'error');
                    }

                    renderFiles();
                    updateStats(successCount, errorCount, successCount > 0 ? totalTime / successCount : 0);
                    updateProgress(i + 1, files.length, `${i + 1}/${files.length} tamamlandƒ±`);
                }

                // Cleanup
                await worker.terminate();

                isProcessing = false;
                updateButtons();

                const totalElapsed = ((Date.now() - startTime) / 1000).toFixed(1);
                log(`üéâ OCR tamamlandƒ±! (${successCount} ba≈üarƒ±lƒ±, ${errorCount} hatalƒ±, ${totalElapsed}s)`, 'success');
                
                // Otomatik ZIP indirme
                if (successCount > 0) {
                    log(`üì¶ ZIP otomatik indiriliyor...`, 'info');
                    setTimeout(() => downloadAsZip(), 500);
                }
            }

            // Download single file - global scope i√ßin
            window.downloadSingle = function(index) {
                const result = results[index];
                if (!result || !result.text) {
                    log(`‚ö†Ô∏è Sayfa ${index + 1} i√ßin sonu√ß yok`, 'error');
                    return;
                }

                const baseName = result.filename.replace(/\.[^/.]+$/, '');
                const content = result.text;
                const filename = `${baseName}_ocr.txt`;

                const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                log(`üíæ Sayfa ${index + 1} indirildi: ${filename}`, 'success');
            };

            // Download all as ZIP
            async function downloadAsZip() {
                const validResults = results.filter(r => r && r.text);
                
                if (validResults.length === 0) {
                    log('‚ö†Ô∏è ƒ∞ndirilecek sonu√ß yok', 'error');
                    return;
                }

                log(`üì¶ ZIP dosyasƒ± olu≈üturuluyor...`, 'info');
                downloadBtn.disabled = true;
                downloadBtn.innerHTML = '‚è≥ ZIP Olu≈üturuluyor...';

                try {
                    const zip = new JSZip();
                    const folder = zip.folder("ocr-sonuclari");

                    // Her sayfa i√ßin ayrƒ± TXT dosyasƒ±
                    for (let i = 0; i < results.length; i++) {
                        const result = results[i];
                        if (!result) continue;

                        const baseName = result.filename.replace(/\.[^/.]+$/, '');
                        
                        if (result.text) {
                            folder.file(`${baseName}_ocr.txt`, result.text);
                        } else if (result.error) {
                            folder.file(`${baseName}_HATA.txt`, `Hata: ${result.error}`);
                        }
                    }

                    // Birle≈ütirilmi≈ü dosya
                    const combinedContent = results
                        .filter(r => r)
                        .map(r => {
                            const header = `\n${'='.repeat(60)}\nüìÑ SAYFA ${r.page}: ${r.filename}\n${'='.repeat(60)}\n`;
                            if (r.error) {
                                return header + `[HATA: ${r.error}]\n`;
                            }
                            return header + r.text;
                        })
                        .join('\n');
                    
                    folder.file('_TUM_SAYFALAR_BIRLESIK.txt', combinedContent);

                    // JSON formatƒ±nda da ekle
                    folder.file('_sonuclar.json', JSON.stringify(results, null, 2));

                    // ZIP olu≈ütur ve indir
                    const zipBlob = await zip.generateAsync({ 
                        type: 'blob',
                        compression: 'DEFLATE',
                        compressionOptions: { level: 6 }
                    }, (metadata) => {
                        const percent = Math.round(metadata.percent);
                        downloadBtn.innerHTML = `‚è≥ ZIP: ${percent}%`;
                    });

                    const timestamp = new Date().toISOString().slice(0, 10);
                    const filename = `ocr-sonuclari_${timestamp}.zip`;

                    const url = URL.createObjectURL(zipBlob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = filename;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);

                    log(`‚úÖ ZIP indirildi: ${filename} (${validResults.length} sayfa + birle≈üik dosya)`, 'success');
                } catch (err) {
                    log(`‚ùå ZIP olu≈üturma hatasƒ±: ${err.message}`, 'error');
                } finally {
                    downloadBtn.disabled = false;
                    downloadBtn.innerHTML = 'üì¶ ZIP ƒ∞ndir (T√ºm√º)';
                }
            }

            // Initial log
            log('‚úÖ Tesseract.js y√ºklendi', 'success');
            log('üëã Dosyalarƒ±nƒ±zƒ± y√ºkleyin ve OCR ba≈ülatƒ±n.', 'info');
        }
    </script>
</body>
</html>